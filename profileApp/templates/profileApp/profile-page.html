<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile Page</title>
    {% load static %}
    <link rel="stylesheet" href={% static "profileApp/profile-page.css" %}>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <div class="menu-overlay" onclick="toggleMenu()"></div>
    <nav class="navbar">
        <div class="left-section">
            <div class="logo">
                <span>♫</span>
                <a href="#" class="brand">BeatBliss</a>
            </div>
        </div>
    
        <div class="button-group">
            <button><a class="nav-link" href={% url "home" %}>Home</a></button>
            <button><a class="nav-link" href={% url "genreHome" %}>Genre</a></button>
            <button><a class="nav-link" href={% url "recHome" %}>Recommender</a></button>
            <button><a class="nav-link" href="#">About</a></button>
        </div>
    
        <div class="auth">
            
            <a href={% url "profile-page" %}
                ><img src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" alt="Profile" class="profile-img"
            /></a>
            
                <a href="{% url 'logout' %}" class="logout-button">Logout</a>
            
        </div>
    </nav>
    <!-- Profile Section -->
    <div class="profile-container">
        <img src="https://media.istockphoto.com/id/1403500817/photo/the-craggies-in-the-blue-ridge-mountains.jpg?s=612x612&w=0&k=20&c=N-pGA8OClRVDzRfj_9AqANnOaDS3devZWwrQNwZuDSk=" alt="Profile Photo" class="profile-photo">
        <div class="profile-info">
            <h2> {{ username }} </h2>
            <p> {{ request.session.current_user }} </p> 
        </div>
    </div>

    <!-- Liked Playlists Section -->
    <div class="section">
        <h3>Your Liked Playlists</h3>
        {% if playlist_dict %}
            {% for playlist_id, playlist in playlist_dict.items %}  
                <div class="song-box">
                    <div class="song-header toggle-btn">
                        <span>Playlist ID: {{ playlist_id }}</span>
                        <button class="toggle-icon">▼</button>
                    </div>
                    <div class="recommendations">
                        <button class="like-button" onclick="likePlaylist('{{ playlist_id }}')">Add to spotify</button>
                        {% for song in playlist.songs %}
                            <div class="song">
                                <img src="{{ song.image_url }}" alt="Song Cover" class="song-img">
                                <div>
                                    <strong>{{ song.title }}</strong> - {{ song.artist }}<br>
                                </div>
                                <button class="like-button" onclick="likeSong('{{ song.spotify_id }}')">❤️</button>
                            </div>
                            
                        {% endfor %}
                    </div>
                    
                </div>
            {% endfor %}
        {% else %}
            <p>No liked playlists found.</p>
        {% endif %}
    </div>

    <!-- Recently Created Playlists Section -->
    <div class="section">
        <h3>Recently Created Playlists</h3>
        {% if history_dict %}
            {% for playlist_id, playlist in history_dict.items %}  
                <div class="song-box">
                    <div class="song-header toggle-btn">
                        <span>Playlist ID: {{ playlist_id }}</span>
                        <button class="toggle-icon">▼</button>
                    </div>
                    <div class="recommendations">
                        <button class="like-button" onclick="likePlaylist('{{ playlist_id }}')">Add to spotify</button>
                        {% for song in playlist.songs %}
                            <div class="song">
                                <img src="{{ song.image_url }}" alt="Song Cover" class="song-img">
                                <div>
                                    <strong>{{ song.title }}</strong> - {{ song.artist }}<br>
                                </div>
                                <button class="like-button" onclick="likeSong('{{ song.spotify_id }}')">❤️</button>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <p>No recently created playlists found.</p>
        {% endif %}
    </div>

    <script>
        $(document).ready(function() {
            $(".toggle-btn").click(function() {
                $(this).closest(".song-box").find(".recommendations").slideToggle();
            });
        });
    </script>

    {% comment %} <div class="section">
        <h3>Your Liked Songs</h3>
        {% if liked_songs %}
            <div class="liked-songs-container">
                {% for song_id, song in liked_songs.items %}
                    <div class="liked-song">
                        <img src="{{ song.image_url }}" alt="Song Cover" class="song-img">
                        <div>
                            <strong>{{ song.title }}</strong> - {{ song.artist }}<br>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p>No liked songs found.</p>
        {% endif %}
    </div> {% endcomment %}
    <!-- Liked Songs Section -->
<div class="section">
    <h3>Your Liked Songs</h3>
    {% if liked_songs %}
        <div class="liked-songs-container">
            {% for song_id, song in liked_songs.items %}
                <div class="liked-song">
                    <img src="{{ song.image_url }}" alt="Song Cover" class="song-img">
                    <div>
                        <strong>{{ song.title }}</strong> - {{ song.artist }}<br>
                    </div>
                </div>
                {% if forloop.counter|divisibleby:6 %}
                    <div class="clear"></div> <!-- Ensures a new row starts after every 6 songs -->
                {% endif %}
            {% endfor %}
        </div>
    {% else %}
        <p>No liked songs found.</p>
    {% endif %}
</div>
<script>
    function toggleMenu() {
        const navLinks = document.querySelector('.nav-links');
        const hamburger = document.querySelector('.hamburger');
        const menuOverlay = document.querySelector('.menu-overlay');
        const buttonGroup = document.querySelector('.button-group');
        
        buttonGroup.classList.toggle('active');
        hamburger.classList.toggle('active');
        menuOverlay.classList.toggle('active');
        
        // Prevent scrolling when menu is open
        if (buttonGroup.classList.contains('active')) {
            document.body.style.overflow = 'hidden';
        } else {
            document.body.style.overflow = 'auto';
        }
    }
    
    document.addEventListener('DOMContentLoaded', function() {
        // Add hamburger menu element if not already in HTML
        if (!document.querySelector('.hamburger')) {
            const navbar = document.querySelector('.navbar');
            const hamburger = document.createElement('div');
            hamburger.className = 'hamburger';
            
            for (let i = 0; i < 3; i++) {
                const bar = document.createElement('div');
                hamburger.appendChild(bar);
            }
            
            hamburger.addEventListener('click', toggleMenu);
            navbar.appendChild(hamburger);
        }
    });
    function likeSong(songId) {
        fetch("/like-song/", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "X-CSRFToken": "{{ csrf_token }}"
            },
            body: JSON.stringify({ song_id: songId })
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === "success") {
                alert("Song added to Liked Songs on Spotify!");
            } else {
                alert("Error: " + data.message);
            }
        })
        .catch(error => console.error("Error:", error));
    }
    function likePlaylist(plId) {
        fetch("/like-playlist/", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "X-CSRFToken": "{{ csrf_token }}"
            },
            body: JSON.stringify({ pl_id: plId })
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === "success") {
                alert("playlist added");
            } else {
                alert("Error: " + data.message);
            }
        })
        .catch(error => console.error("Error:", error));
    }
</script>
</body>
</html>
